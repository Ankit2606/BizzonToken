#pragma version =0.4.4;
#pragma allow-post-modification;
#pragma compute-asm-ltr;

#include "tact_SamplePresale.headers.fc";
#include "tact_SamplePresale.stdlib.fc";
#include "tact_SamplePresale.constants.fc";
#include "tact_SamplePresale.storage.fc";

;;
;; Contract SamplePresale functions
;;

(cell, int, slice, int, cell) $SamplePresale$_contract_init() impure inline_ref {
    var (($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data)) = (null(), 100, null(), null(), null());
    $self'owner = __tact_context_get_sender();
    $self'TonBalance = 0;
    $self'TokenData~__tact_dict_set_int_cell(257, 0, $TokenDistrubuteInfo$_store_cell($TokenDistrubuteInfo$_constructor_name_tokenDistrubutedPercentage_totalPhaseToken_percentage_totalSuppliedToken(__gen_slice_string_94e8e93f0812228e571b8daeb81631804e5482ffb121e048ba63723b90abfe3a(), 3, 2668500000000000, 555, 0)));
    $self'TokenData~__tact_dict_set_int_cell(257, 1, $TokenDistrubuteInfo$_store_cell($TokenDistrubuteInfo$_constructor_name_tokenDistrubutedPercentage_totalPhaseToken_percentage_totalSuppliedToken(__gen_slice_string_a30da35b11a13f7c165f354544348f0e59e4f733f714de9954ad0c5ee8bc0ba1(), 11, 9784500000000000, 455, 0)));
    $self'TokenData~__tact_dict_set_int_cell(257, 2, $TokenDistrubuteInfo$_store_cell($TokenDistrubuteInfo$_constructor_name_tokenDistrubutedPercentage_totalPhaseToken_percentage_totalSuppliedToken(__gen_slice_string_404a9b6bd3e2952c28511dedaf0b331844770f257f36242af3b55d238b8e1220(), 3, 2668500000000000, 0, 0)));
    $self'TokenData~__tact_dict_set_int_cell(257, 3, $TokenDistrubuteInfo$_store_cell($TokenDistrubuteInfo$_constructor_name_tokenDistrubutedPercentage_totalPhaseToken_percentage_totalSuppliedToken(__gen_slice_string_7975f2f8f6fdf41ad27f6b31b47837bb3c13ddf984bfd79b0efd90f5c7cb1d15(), 15, 13342500000000000, 0, 0)));
    $self'TokenData~__tact_dict_set_int_cell(257, 4, $TokenDistrubuteInfo$_store_cell($TokenDistrubuteInfo$_constructor_name_tokenDistrubutedPercentage_totalPhaseToken_percentage_totalSuppliedToken(__gen_slice_string_4356a74be65283c1e5556f23f289ff7aa13784e82ae7c693d4f909b1b17b2bb1(), 21, 18679500000000000, 278, 0)));
    $self'TokenData~__tact_dict_set_int_cell(257, 5, $TokenDistrubuteInfo$_store_cell($TokenDistrubuteInfo$_constructor_name_tokenDistrubutedPercentage_totalPhaseToken_percentage_totalSuppliedToken(__gen_slice_string_85b8687e528e86a10d0245b159b4524088b23db45798521e0ac3289b5f29c9b7(), 3, 2668500000000000, 417, 0)));
    $self'TokenData~__tact_dict_set_int_cell(257, 6, $TokenDistrubuteInfo$_store_cell($TokenDistrubuteInfo$_constructor_name_tokenDistrubutedPercentage_totalPhaseToken_percentage_totalSuppliedToken(__gen_slice_string_f38a82a01fa1092bc1869cdd0bcc77747180f82e943552573aba0154aa4275b0(), 6, 5337000000000000, 0, 0)));
    $self'TokenData~__tact_dict_set_int_cell(257, 7, $TokenDistrubuteInfo$_store_cell($TokenDistrubuteInfo$_constructor_name_tokenDistrubutedPercentage_totalPhaseToken_percentage_totalSuppliedToken(__gen_slice_string_33e8d8abf0bddfe2b43c483aa9c3c3f644497757b56ac17f2c16c3d10074b4c0(), 10, 8895000000000000, 0, 0)));
    $self'TokenData~__tact_dict_set_int_cell(257, 8, $TokenDistrubuteInfo$_store_cell($TokenDistrubuteInfo$_constructor_name_tokenDistrubutedPercentage_totalPhaseToken_percentage_totalSuppliedToken(__gen_slice_string_4ea8d50de9b56e3545704a91804c774b662f1bd0400dde80a2d6039eacf7e9e8(), 10, 8895000000000000, 0, 0)));
    $self'TokenData~__tact_dict_set_int_cell(257, 9, $TokenDistrubuteInfo$_store_cell($TokenDistrubuteInfo$_constructor_name_tokenDistrubutedPercentage_totalPhaseToken_percentage_totalSuppliedToken(__gen_slice_string_5ef9dbe51a9547187d8fa4204806df0ee9bc42580647e12d97b91b84e07b7b89(), 5, 4447500000000000, 555, 0)));
    $self'TokenData~__tact_dict_set_int_cell(257, 10, $TokenDistrubuteInfo$_store_cell($TokenDistrubuteInfo$_constructor_name_tokenDistrubutedPercentage_totalPhaseToken_percentage_totalSuppliedToken(__gen_slice_string_756293eba67bb40e05a872ed2a3cde8e953d95f4e401fd873e211c2ed78a0c22(), 13, 11563500000000000, 417, 0)));
    return ($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data);
}

((cell, int, slice, int, cell), tuple) $SamplePresale$_fun_getData((cell, int, slice, int, cell) $self, slice $addr, int $num) impure inline_ref {
    var (($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data)) = $self;
    var ($data'data, $data'size) = $UserArrayData$_not_null($UserArrayData$_load_opt(__tact_dict_get_slice_cell($self'Data, 267, $addr)));
    return (($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data), $UserData$_load_opt(__tact_dict_get_int_cell($data'data, 257, $num)));
}

((cell, int, slice, int, cell), tuple) $SamplePresale$_fun_getTokenInfo((cell, int, slice, int, cell) $self, int $index) impure inline_ref {
    var (($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data)) = $self;
    return (($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data), $TokenDistrubuteInfo$_load_opt(__tact_dict_get_int_cell($self'TokenData, 257, $index)));
}

((cell, int, slice, int, cell), slice) $SamplePresale$_fun_balance((cell, int, slice, int, cell) $self) impure inline_ref {
    var (($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data)) = $self;
    return (($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data), $Int$_fun_toCoinsString(__tact_my_balance()));
}

((cell, int, slice, int, cell), slice) $SamplePresale$_fun_owner((cell, int, slice, int, cell) $self) impure inline_ref {
    var (($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data)) = $self;
    return (($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data), $self'owner);
}

;;
;; Receivers of a Contract SamplePresale
;;

(((cell, int, slice, int, cell)), ()) $SamplePresale$_internal_binary_BuyTokens((cell, int, slice, int, cell) $self, (int, slice, slice) $msg) impure inline {
    var ($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data) = $self;
    var ($msg'Amount, $msg'masterAddress, $msg'userAddress) = $msg;
    var ($ctx'bounced, $ctx'sender, $ctx'value, $ctx'raw) = __tact_context_get();
    int $fee = $Context$_fun_readForwardFee(($ctx'bounced, $ctx'sender, $ctx'value, $ctx'raw));
    int $TokenAmount = (($ctx'value - $fee) * $self'TonVal);
    tuple $gotButUnsure = $UserArrayData$_load_opt(__tact_dict_get_slice_cell($self'Data, 267, __tact_context_get_sender()));
    var ($seedData'name, $seedData'tokenDistrubutedPercentage, $seedData'totalPhaseToken, $seedData'percentage, $seedData'totalSuppliedToken) = $TokenDistrubuteInfo$_not_null($TokenDistrubuteInfo$_load_opt(__tact_dict_get_int_cell($self'TokenData, 257, 0)));
    throw_unless(35441, ($seedData'totalPhaseToken >= ($seedData'totalSuppliedToken + $TokenAmount)));
    if ((~ null?($gotButUnsure))) {
        var ($gotButsure'data, $gotButsure'size) = $UserArrayData$_not_null($UserArrayData$_load_opt(__tact_dict_get_slice_cell($self'Data, 267, __tact_context_get_sender())));
        var ($userInfo'UserAddress, $userInfo'TotalToken, $userInfo'RemainingToken, $userInfo'StartTime, $userInfo'VestingDuration, $userInfo'LastClaimTime, $userInfo'CliffTime, $userInfo'ReleaseInterval, $userInfo'PhaseName, $userInfo'Active, $userInfo'TonToken) = $UserData$_constructor_UserAddress_TotalToken_RemainingToken_StartTime_VestingDuration_LastClaimTime_CliffTime_ReleaseInterval_PhaseName_Active_TonToken(__tact_context_get_sender(), $TokenAmount, $TokenAmount, now(), (now() + 300), (now() + 30), 90, (now() + 30), $seedData'name, true, $ctx'value);
        $gotButsure'data~__tact_dict_set_int_cell(257, ($gotButsure'size + 1), $UserData$_store_cell(($userInfo'UserAddress, $userInfo'TotalToken, $userInfo'RemainingToken, $userInfo'StartTime, $userInfo'VestingDuration, $userInfo'LastClaimTime, $userInfo'CliffTime, $userInfo'ReleaseInterval, $userInfo'PhaseName, $userInfo'Active, $userInfo'TonToken)));
        $gotButsure'size = ($gotButsure'size + 1);
        $self'Data~__tact_dict_set_slice_cell(267, __tact_context_get_sender(), $UserArrayData$_store_cell(($gotButsure'data, $gotButsure'size)));
    } else {
        tuple $getData = $UserArrayData$_load_opt(__tact_dict_get_slice_cell($self'Data, 267, __tact_context_get_sender()));
        cell $x = null();
        var ($userInfo'UserAddress, $userInfo'TotalToken, $userInfo'RemainingToken, $userInfo'StartTime, $userInfo'VestingDuration, $userInfo'LastClaimTime, $userInfo'CliffTime, $userInfo'ReleaseInterval, $userInfo'PhaseName, $userInfo'Active, $userInfo'TonToken) = $UserData$_constructor_UserAddress_TotalToken_RemainingToken_StartTime_VestingDuration_LastClaimTime_CliffTime_ReleaseInterval_PhaseName_Active_TonToken(__tact_context_get_sender(), $TokenAmount, $TokenAmount, now(), (now() + 300), (now() + 30), 90, (now() + 30), $seedData'name, true, $ctx'value);
        $x~__tact_dict_set_int_cell(257, 1, $UserData$_store_cell(($userInfo'UserAddress, $userInfo'TotalToken, $userInfo'RemainingToken, $userInfo'StartTime, $userInfo'VestingDuration, $userInfo'LastClaimTime, $userInfo'CliffTime, $userInfo'ReleaseInterval, $userInfo'PhaseName, $userInfo'Active, $userInfo'TonToken)));
        var ($storeData'data, $storeData'size) = $UserArrayData$_constructor_data_size($x, 1);
        $self'Data~__tact_dict_set_slice_cell(267, __tact_context_get_sender(), $UserArrayData$_store_cell(($storeData'data, $storeData'size)));
    }
    $seedData'totalSuppliedToken = $seedData'totalSuppliedToken + $TokenAmount;
    $self'TokenData~__tact_dict_set_int_cell(257, 0, $TokenDistrubuteInfo$_store_cell(($seedData'name, $seedData'tokenDistrubutedPercentage, $seedData'totalPhaseToken, $seedData'percentage, $seedData'totalSuppliedToken)));
    return (($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data), ());
}

((cell, int, slice, int, cell), ()) $SamplePresale$_internal_text_beb2935a82089b154d32f99c4377aa960aa115366cc2c602755e36b97f505cec((cell, int, slice, int, cell) $self) impure inline {
    var ($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data) = $self;
    throw_unless(15509, ( __tact_slice_eq_bits($self'owner, __tact_context_get_sender()) ));
    $global_send($SendParameters$_constructor_to_bounce_value_mode(__tact_context_get_sender(), true, (__tact_my_balance() - 100000000), (64 + 2)));
    return (($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data), ());
}

(((cell, int, slice, int, cell)), ()) $SamplePresale$_internal_binary_ClaimTokens((cell, int, slice, int, cell) $self, (int, slice, slice) $msg) impure inline {
    var ($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data) = $self;
    var ($msg'amount, $msg'cenderadd, $msg'senderadd) = $msg;
    var ($presaleData'data, $presaleData'size) = $UserArrayData$_not_null($UserArrayData$_load_opt(__tact_dict_get_slice_cell($self'Data, 267, __tact_context_get_sender())));
    int $size = $presaleData'size;
    cell $x = $presaleData'data;
    int $amount = 0;
    var ($key, $value, $fresh$flag_0) = __tact_dict_min_int_cell($x, 257);
    while ($fresh$flag_0) {
        var ($value'UserAddress, $value'TotalToken, $value'RemainingToken, $value'StartTime, $value'VestingDuration, $value'LastClaimTime, $value'CliffTime, $value'ReleaseInterval, $value'PhaseName, $value'Active, $value'TonToken) = $UserData$_not_null($UserData$_load_opt($value));
        if ((now() >= $value'VestingDuration)) {
            $amount = $amount + $value'RemainingToken;
            $value'Active = false;
            $value'LastClaimTime = $value'VestingDuration;
            $value'RemainingToken = 0;
            $x~__tact_dict_set_int_cell(257, $key, $UserData$_store_cell(($value'UserAddress, $value'TotalToken, $value'RemainingToken, $value'StartTime, $value'VestingDuration, $value'LastClaimTime, $value'CliffTime, $value'ReleaseInterval, $value'PhaseName, $value'Active, $value'TonToken)));
            var ($newStruct'data, $newStruct'size) = $UserArrayData$_constructor_data_size($x, $size);
            $self'Data~__tact_dict_set_slice_cell(267, __tact_context_get_sender(), $UserArrayData$_store_cell(($newStruct'data, $newStruct'size)));
        } else {
            int $totalClaim = ((now() - $value'LastClaimTime) / $value'ReleaseInterval);
            var ($seedData'name, $seedData'tokenDistrubutedPercentage, $seedData'totalPhaseToken, $seedData'percentage, $seedData'totalSuppliedToken) = $TokenDistrubuteInfo$_not_null($TokenDistrubuteInfo$_load_opt(__tact_dict_get_int_cell($self'TokenData, 257, 0)));
            int $tokenClaimed = ((($value'TotalToken / 10000) * $seedData'percentage) * $totalClaim);
            $amount = $amount + $tokenClaimed;
            $value'LastClaimTime = $value'LastClaimTime + ($totalClaim * $value'ReleaseInterval);
            $value'RemainingToken = $value'RemainingToken - $tokenClaimed;
            $x~__tact_dict_set_int_cell(257, $key, $UserData$_store_cell(($value'UserAddress, $value'TotalToken, $value'RemainingToken, $value'StartTime, $value'VestingDuration, $value'LastClaimTime, $value'CliffTime, $value'ReleaseInterval, $value'PhaseName, $value'Active, $value'TonToken)));
            var ($newStruct'data, $newStruct'size) = $UserArrayData$_constructor_data_size($x, $size);
            $self'Data~__tact_dict_set_slice_cell(267, __tact_context_get_sender(), $UserArrayData$_store_cell(($newStruct'data, $newStruct'size)));
        }
        ($key, $value, $fresh$flag_0) = __tact_dict_next_int_cell($x, 257, $key);
    }
    $global_send($SendParameters$_constructor_to_value_mode_bounce_body($msg'cenderadd, 0, 128, true, $TokenTransfer$_store_cell($TokenTransfer$_constructor_queryId_amount_destination_response_destination_custom_payload_forward_ton_amount_forward_payload(0, $amount, $msg'senderadd, $msg'senderadd, null(), 1, begin_parse(__gen_cell_comment_3fe93897158698e4d473b74414d7493716b0fc3a70310934873f0019daaccab4())))));
    return (($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data), ());
}

(((cell, int, slice, int, cell)), ()) $SamplePresale$_internal_binary_Deploy((cell, int, slice, int, cell) $self, (int) $deploy) impure inline {
    var ($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data) = $self;
    var ($deploy'queryId) = $deploy;
    ($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data)~$SamplePresale$_fun_notify($DeployOk$_store_cell($DeployOk$_constructor_queryId($deploy'queryId)));
    return (($self'TokenData, $self'TonVal, $self'owner, $self'TonBalance, $self'Data), ());
}

;;
;; Get methods of a Contract SamplePresale
;;

_ %getData(slice $$addr, int $$num) method_id(103147) {
    slice $addr = __tact_verify_address($$addr);
    int $num = $$num;
    var self = $SamplePresale$_contract_load();
    var res = self~$SamplePresale$_fun_getData($addr, $num);
    return $UserData$_to_opt_external(res);
}

_ %getTokenInfo(int $$index) method_id(96528) {
    int $index = $$index;
    var self = $SamplePresale$_contract_load();
    var res = self~$SamplePresale$_fun_getTokenInfo($index);
    return $TokenDistrubuteInfo$_to_opt_external(res);
}

_ %balance() method_id(104128) {
    var self = $SamplePresale$_contract_load();
    var res = self~$SamplePresale$_fun_balance();
    return res;
}

_ %owner() method_id(83229) {
    var self = $SamplePresale$_contract_load();
    var res = self~$SamplePresale$_fun_owner();
    return res;
}

_ supported_interfaces() method_id {
    return (
        "org.ton.introspection.v0"H >> 128,
        "org.ton.abi.ipfs.v0"H >> 128,
        "org.ton.deploy.lazy.v0"H >> 128,
        "org.ton.chain.workchain.v0"H >> 128,
        "org.ton.ownable"H >> 128
    );
}

_ get_abi_ipfs() method_id {
    return "ipfs://QmNi7PAoS5PbPE2btkqfLBv49S3FV4HemPcZ6Uzwm2kRwY";
}

_ lazy_deployment_completed() method_id {
    return get_data().begin_parse().load_int(1);
}

;;
;; Routing of a Contract SamplePresale
;;

((cell, int, slice, int, cell), int) $SamplePresale$_contract_router_internal((cell, int, slice, int, cell) self, int msg_bounced, slice in_msg) impure inline_ref {
    ;; Handle bounced messages
    if (msg_bounced) {
        return (self, true);
    }
    
    ;; Parse incoming message
    int op = 0;
    if (slice_bits(in_msg) >= 32) {
        op = in_msg.preload_uint(32);
    }
    
    
    ;; Receive BuyTokens message
    if (op == 3868199946) {
        var msg = in_msg~$BuyTokens$_load();
        self~$SamplePresale$_internal_binary_BuyTokens(msg);
        return (self, true);
    }
    
    ;; Receive ClaimTokens message
    if (op == 86893668) {
        var msg = in_msg~$ClaimTokens$_load();
        self~$SamplePresale$_internal_binary_ClaimTokens(msg);
        return (self, true);
    }
    
    ;; Receive Deploy message
    if (op == 2490013878) {
        var msg = in_msg~$Deploy$_load();
        self~$SamplePresale$_internal_binary_Deploy(msg);
        return (self, true);
    }
    
    ;; Text Receivers
    if (op == 0) {
        var text_op = slice_hash(in_msg);
        
        ;; Receive "withdraw safe" message
        if (text_op == 0xbeb2935a82089b154d32f99c4377aa960aa115366cc2c602755e36b97f505cec) {
            self~$SamplePresale$_internal_text_beb2935a82089b154d32f99c4377aa960aa115366cc2c602755e36b97f505cec();
            return (self, true);
        }
    }
    
    return (self, false);
}

() recv_internal(int msg_value, cell in_msg_cell, slice in_msg) impure {
    
    ;; Context
    var cs = in_msg_cell.begin_parse();
    var msg_flags = cs~load_uint(4);
    var msg_bounced = -(msg_flags & 1);
    slice msg_sender_addr = __tact_verify_address(cs~load_msg_addr());
    __tact_context = (msg_bounced, msg_sender_addr, msg_value, cs);
    __tact_context_sender = msg_sender_addr;
    
    ;; Load contract data
    var self = $SamplePresale$_contract_load();
    
    ;; Handle operation
    int handled = self~$SamplePresale$_contract_router_internal(msg_bounced, in_msg);
    
    ;; Throw if not handled
    throw_unless(130, handled);
    
    ;; Persist state
    $SamplePresale$_contract_store(self);
}
